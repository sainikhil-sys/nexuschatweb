{% extends 'base.html' %}
{% block title %}{{ org_name }} â€” Members{% endblock %}

{% block body %}
<div class="dashboard-app">
    <aside class="dash-sidebar">
        <div class="dash-sidebar-header">
            <img src="{{ current_org.logo_url }}" alt="" class="dash-org-logo">
            <div>
                <h3>{{ current_org.name }}</h3>
                <span class="badge badge-{{ current_org.plan.tier|default:'free' }}">{{
                    current_org.plan.tier|default:'Free'|title }}</span>
            </div>
        </div>
        <nav class="dash-nav">
            <a href="{% url 'organizations:dashboard' %}" class="dash-nav-item">
                <span class="material-icons-round">dashboard</span> Overview
            </a>
            <a href="{% url 'organizations:members' %}" class="dash-nav-item active">
                <span class="material-icons-round">people</span> Members
            </a>
            <a href="{% url 'organizations:settings' %}" class="dash-nav-item">
                <span class="material-icons-round">settings</span> Settings
            </a>
            <a href="{% url 'chat:chat_home' %}" class="dash-nav-item">
                <span class="material-icons-round">chat</span> Back to Chat
            </a>
        </nav>
    </aside>

    <main class="dash-main">
        <div class="dash-header">
            <h1>Team Members</h1>
            <p>Manage your organization's team</p>
        </div>

        <!-- Invite Section -->
        <div class="dash-card">
            <h3><span class="material-icons-round">person_add</span> Invite New Member</h3>
            <form method="post" action="{% url 'organizations:send_invitation' %}" class="invite-form">
                {% csrf_token %}
                <div class="invite-row">
                    <input type="email" name="email" placeholder="Email address" required class="form-input">
                    <select name="role" class="form-input">
                        <option value="member">Member</option>
                        <option value="moderator">Moderator</option>
                        <option value="admin">Admin</option>
                    </select>
                    <button type="submit" class="btn btn-primary">
                        <span class="material-icons-round">send</span> Send Invite
                    </button>
                </div>
            </form>
        </div>

        <!-- Members Table -->
        <div class="dash-card">
            <h3><span class="material-icons-round">group</span> Current Members ({{ members|length }})</h3>
            <div class="members-table">
                {% for m in members %}
                <div class="member-row-full">
                    <div class="member-left">
                        <img src="{{ m.user.profile.avatar_url }}" alt="" class="member-avatar">
                        <div class="member-info">
                            <strong>{{ m.user.get_full_name|default:m.user.username }}</strong>
                            <span class="member-email">{{ m.user.email }}</span>
                        </div>
                    </div>
                    <div class="member-right">
                        <span class="badge badge-{{ m.role }}">{{ m.role|title }}</span>
                        {% if m.role != 'owner' %}
                        <form method="post" class="inline-form">
                            {% csrf_token %}
                            <input type="hidden" name="user_id" value="{{ m.user.id }}">
                            <input type="hidden" name="action" value="change_role">
                            <select name="role" onchange="this.form.submit()" class="form-input-sm">
                                <option value="member" {% if m.role=='member' %}selected{% endif %}>Member</option>
                                <option value="moderator" {% if m.role=='moderator' %}selected{% endif %}>Moderator
                                </option>
                                <option value="admin" {% if m.role=='admin' %}selected{% endif %}>Admin</option>
                            </select>
                        </form>
                        <form method="post" class="inline-form" onsubmit="return confirm('Remove this member?')">
                            {% csrf_token %}
                            <input type="hidden" name="user_id" value="{{ m.user.id }}">
                            <input type="hidden" name="action" value="remove">
                            <button type="submit" class="icon-btn danger" title="Remove">
                                <span class="material-icons-round">person_remove</span>
                            </button>
                        </form>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </main>
</div>
{% endblock %}